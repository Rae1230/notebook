---
sort: 2
---

# Calculus of Variations and Optimal Control 

## 1 Basic Concepts

### 1.1 Function and Functional

#### (1) Function

#### (2) Functional

&emsp;&emsp;变量$$ J $$是依赖于函数$$ f(x) $$的泛函，记作$$ J=J(f(x)) $$，如果对每个函数$$ f(x) $$，存在对应的$$ J $$值。

### 1.2 Increment

#### (1) Increment of a Function

**DEFINITION 2.1** 函数$$ f $$的增量，表示为$$ \Delta f $$，定义为

$$ \Delta f \triangleq f(t + \Delta t) - f(t)
\tag{2.1.4}
$$

从定义可以看出，$$ \Delta f $$与自变量$$ t $$和自变量的增量$$ \Delta t $$都相关，严格来说，函数的增量需要写成形如$$ \Delta f(t + \Delta t) $$的函数。

#### (2) Increment of a Functional

**DEFINITION 2.2** 泛函$$ J $$的增量，表示为$$ \Delta J $$，定义为

$$\begin{aligned}
    \boxed{\Delta J \triangleq J(x(t) + \delta x(t)) - J(x(t))}
\end{aligned}
\tag{2.1.7}
$$

其中，$$ \delta x(t) $$称为函数$$ x(t) $$的<font color="#3FBF3F">variation</font>。泛函的增量与函数$$ x(t) $$及其增量$$ \delta x(t) $$相关，严格来说，泛函的增量需要写成$$ \Delta J(x(t) , \delta x(t)) $$。

### 1.3 Differential and Variation

#### (1) Differential of a Function

&emsp;&emsp;定义函数$$ J $$在点$$ t^* $$处的增量为

$$ \Delta f \triangleq f(t^*+\Delta t) - f(t^*) 
\tag{2.1.10}
$$

将$$ f(t^*+\Delta t) $$在$$ t^* $$处Taylor展开，得到

$$ \Delta f
= f(t^*) 
+ \left( \frac{df}{dt} \right)_* \Delta t 
+ \frac{1}{2!} \left( \frac{d^2f}{dt^2} \right)_* (\Delta t)^2 
+ \cdots
- f(t^*) 
\tag{2.1.11}
$$

忽略$$ \Delta t $$中的高阶项，

$$ \Delta f
= \left( \frac{df}{dt} \right)_* \Delta t 
= \dot{f}(t^*) \Delta t 
= df
\tag{2.1.12}
$$

其中，$$ df $$称为$$ f $$在点$$ t^* $$处的<font color="#3FBF3F">differential</font>。$$ \dot{f}(t^*) $$是$$ f $$在点$$ t^* $$处的<font color="#3FBF3F">derivative</font>或slope。换言之，微分$$ df $$是增量$$ \Delta t $$的一阶近似。增量、微分和导数的关系如图2.1所示。

<center>
    <figure>
        <img src="../../notebook\part3\images\fig2_1.JPG" width=350px>
        <figcaption>Figure 2.1 Increment, Differential and Dericative</figcaption>
    </figure>
</center>

#### (2) Variation of a Functional

&emsp;&emsp;泛函的增量为

$$ \Delta J  
\triangleq J(x(t)+\delta x(t)) - J(x(t))
\tag{2.1.14}
$$

对$$ J(x(t)+\delta x(t)) $$进行Taylor展开，得到

$$ \begin{aligned}
\Delta J
& = J(x(t)) + \frac{\partial J}{\partial x} \delta x(t) 
  + \frac{1}{2!} \frac{\partial ^2 J}{\partial x^2} (\delta x(t))^2
  + \cdots - J(x(t)) \\
& = \frac{\partial J}{\partial x} \delta x(t) 
  + \frac{1}{2!} \frac{\partial ^2 J}{\partial x^2} (\delta x(t))^2
  + \cdots \\
& = \delta J + \delta^2 J + \cdots
\end{aligned}
\tag{2.1.15}
$$

其中，

$$ \delta J = \frac{\partial J}{\partial x} \delta x(t) 
\; \text{和} \; 
\delta^2 J = \frac{1}{2!} \frac{\partial ^2 J}{\partial x^2} (\delta x(t))^2
\tag{2.1.16}
$$

分别称为泛函$$ J $$的<font color="#3FBF3F">一阶变分</font>和<font color="#3FBF3F">二阶变分</font>。泛函$$ J $$的一阶变分$$ \delta J $$是增量$$ \delta J $$的线性（一阶近似）部分。泛函的增量与一阶变分的关系如图2.2所示。

<center>
    <figure>
        <img src="../../notebook\part3\images\fig2_2.JPG" width=360px>
        <figcaption>Figure 2.1 Increment and the First Variation</figcaption>
    </figure>
</center>

<br /> 

## 2 Optimum of a Function and a Functional

```note
变分在求泛函的最优值中所起的作用与微分在求函数的极值或最优值的所起的作用相同。
```

**DEFINITION 2.3** Optimum of a Function：如果存在一个正数$$ \epsilon $$，使得对于范围$$ D $$内的所有点都有$$ \vert t-t^* \vert \lt \epsilon $$，则称函数$$ f(t) $$在点$$ t^* $$处存在极值，$$ f(t) $$的增量符号相同。

&emsp;&emsp;函数取最值的必要条件为一阶微分消失，i.e.$$ df=0 $$。充分条件为：  
&emsp;&emsp;1.最小值：二阶微分为正，i.e.$$ d^2 f \gt 0 $$；  
&emsp;&emsp;2.最大值：二阶微分为负，i.e.$$ d^2 f \lt 0 $$。  
如果$$ d^2 f = 0 $$，那么该点为驻点（或拐点）。

**DEFINITION 2.4** <font color="#3FBF3F">Optimum of a Function</font>：如果存在一个正的$$ \epsilon $$，使得对于范围$$ \Omega $$内的所有函数$$ x $$都有$$ \vert x-x^{*}\vert \lt \epsilon $$，则称泛函$$ J $$在$$ x^{*} $$处取到relative optimum，$$ J $$的增量与之同符号。

&emsp;&emsp;换言之，如果

$$ \Delta J = J(x) - J(x^*) \ge 0 
\tag{2.2.3}
$$

那么$$ J(x^*) $$为极小值。如果

$$ \Delta J = J(x) - J(x^*) \le 0 
\tag{2.2.4}
$$

那么$$ J(x^{*}) $$为极大值。如果以上关系对于任意的$$ \epsilon $$都成立，那么$$ J(x^{*}) $$为全局最值。

**THEOREM 2.1** <font color="#3FBF3F">fundamental theorem of the calculus of variations</font>  
&emsp;&emsp;$$ x^{*}(t) $$为optimum的必要条件为：$$ J $$在$$ x^{*}(t) $$处的一阶变分为0，i.e.对于所有可能的$$ \delta x(t) $$值，有$$ \delta J(x^*(t),\delta x(t)) = 0 $$。在此基础上，充分条件：对于最小值，有二阶变分$$ \delta^2 J \gt 0 $$；对于最大值，有二阶变分$$ \delta^2 J \lt 0 $$。

<br /> 

## 3 The Basic Variational Problem

### 3.1 Fixed-End Time and Fixed-End State System

&emsp;&emsp;本节解决初始时间、状态和结束时间、状态都是确定的fixed-end time and fixed-end state问题。$$ x(t) $$是一阶导数连续的标量函数，向量情况也可以类似处理。问题是要找到最优函数$$ x^*(t) $$使得泛函

$$ J(x(t)) = \int_{t_0}^{t_f} V(x(t),\dot{x}(t),t) 
\tag{2.3.1}
$$

有相对最优。假设被积函数$$ V $$一阶连续且对所有的参数二阶可偏微分，$$ t_0 $$和$$ t_f $$确定，终点也确定，i.e.

$$ x(t=t_0) ,\; x(t=t_f)=x_f 
\tag{2.3.2}
$$

由定理2.1可知，最值的必要条件是泛函的变分消失。所以，要求$$ x^*(t) $$，需要先定义增量，求变分，然后用定理2.1。

&emsp;&emsp;fixed-end time and fixed-end state问题步骤如下：

* Step 1: Assumption of an Optimum
* Step 2: Variations and Increment
* Step 3: First Variation
* Step 4: Fundamental Theorem
* Step 5: Fundamental Lemma
* Step 6: Euler-Lagrange Equation

**Step 1: Assumption of an Optimum**

<center>
    <figure>
        <img src="../../notebook\part3\images\fig2_4.JPG" width=360px>
        <figcaption>Figure 2.4 Fixed-End Time and Fixed-End State System</figcaption>
    </figure>
</center>

&emsp;&emsp;假设$$ x^*(t) $$为最优解，取$$ x^*(t) $$附近的函数$$ x_a(t)= x^*(t) + \delta x(t) $$，其中$$ \delta x(t) $$是如图2.4所示的变分。函数$$ x_a(t) $$满足边界条件(2.3.2)，因此必须满足

$$ \delta x(t_0) = \delta x(t_f) = 0 
\tag{2.3.3}
$$

**Step 2: Variations and Increment**

&emsp;&emsp;定义增量为

$$ \begin{aligned}
\Delta J(x^*(t),\delta x(t)) \triangleq 
& J(x^*(t) + \delta x(t) , \dot{x}^*(t) + \delta \dot{x}(t) ,t) \\
& - J(x^*(t),\dot{x}^*(t),t) \\
= & \int_{t_0}^{t_f}
        {V(x^*(t) + \delta x(t) , \dot{x}^*(t) + \delta \dot{x}(t) ,t) \, dt} \\
&  - \int_{t_0}^{t_f}
    {V(x^*(t),\dot{x}^*(t),t) \, dt}
\end{aligned}
\tag{2.3.4}
$$

将积分合并，得到

$$ \begin{aligned}
    \Delta J(x^*(t),\delta x(t))
= & \int_{t_0}^{t_f} 
    [ V(x^*(t) + \delta x(t) , \dot{x}^*(t) + \delta \dot{x}(t) ,t) \\
        & - V(x^*(t),\dot{x}^*(t),t)] \, dt 
\end{aligned}
\tag{2.3.5}
$$

其中，

$$ \dot{x}(t) = \frac{dx(t)}{dt} 
\quad \text{and} \quad
\delta \dot{x}(t) = \frac{d}{dt}\{ \delta x(t) \}
\tag{2.3.6}
$$

对式(2.3.5)中的$$ V $$关于点$$ x^*(t) $$和$$ \dot{x}^*(t) $$作Taylor展开

$$ \begin{aligned}
\Delta J = & \Delta J(x^*(t),\delta x(t)) \\
= & \int_{t_0}^{t_f} 
    \bigg [
        \frac{\partial V(x^*(t),\dot{x}^*(t),t)}{\partial x} \delta x(t)
        + \frac{\partial V(x^*(t),\dot{x}^*(t),t)}{\partial \dot{x}} \delta \dot{x}(t) \\
     &  + \frac{1}{2!} 
            \left \{ 
                \frac{\partial ^2 V(\cdots)}{\partial x^2}(\delta x(t))^2 
                + \frac{\partial ^2 V(\cdots)}{\partial \dot{x}^2}(\delta \dot{x}(t))^2 
                + 2 \frac{\partial ^2 V(\cdots)}{\partial x \partial \dot{x}}
            \right \}
        + \cdots
    \bigg] dt
\end{aligned}
\tag{2.3.7}
$$

**Step 3: First Variation**

&emsp;&emsp;保留$$ \delta x(t) $$和$$ \delta \dot{x}(t) $$中的线性项，得到变分

$$ \delta J(x^*(t),\delta x(t))
= \int_{t_0}^{t_f} 
    \bigg [
        \frac{\partial V(x^*(t),\dot{x}^*(t),t)}{\partial x} \delta x(t)
        + \frac{\partial V(x^*(t),\dot{x}^*(t),t)}{\partial \dot{x}} \delta \dot{x}(t)
    \bigg] dt
\tag{2.3.8}
$$

为了完全用含$$ \delta x(t) $$的项来表示，可以对第二项进行分部积分

$$ \begin{aligned}
    \int_{t_0}^{t_f} 
        \left( \frac{\partial V}{\partial \dot{x}} \right)_*
        \delta \dot{x}(t) dt
& = \int_{t_0}^{t_f} 
        \left( \frac{\partial V}{\partial \dot{x}} \right)_*
        \frac{d}{dt} (\delta x(t)) dt \\
& = \int_{t_0}^{t_f}
        \left( \frac{\partial V}{\partial \dot{x}} \right)_*
        d(\delta x(t)) \\
& = \left[ 
        \left( \frac{\partial V}{\partial \dot{x}} \right)_*
        \delta x(t)
    \right] _{t_0}^{t_f}
    - \int_{t_0}^{t_f} \delta x(t) 
        \frac{d}{dt} 
        \left( \frac{\partial V}{\partial \dot{x}} \right)_* dt
\end{aligned}
\tag{2.3.9}
$$

把式(2.3.9)代入(2.3.8)得到一阶变分为

$$ \begin{aligned}
    \delta J(x^*(t),\delta x(t))
= & \int_{t_0}^{t_f} 
        \left( \frac{\partial V}{\partial x} \right)_* \delta x(t) dt
     + \left[ 
            \left( \frac{\partial V}{\partial \dot{x}} \right)_*
        \delta x(t)
    \right] _{t_0}^{t_f} \\
& - \int_{t_0}^{t_f} \delta x(t) 
        \frac{d}{dt} 
        \left( \frac{\partial V}{\partial \dot{x}} \right)_*
        dt \\
= & \int_{t_0}^{t_f} 
        \left[ 
            \left( \frac{\partial V}{\partial x} \right)_*
          - \frac{d}{dt} 
                \left( \frac{\partial V}{\partial \dot{x}} \right)_*
        \right]
        \delta x(t)dt \\
& + \left. \left[ 
        \left( \frac{\partial V}{\partial \dot{x}} \right)_*
        \delta x(t)
    \right]  \right| _{t_0}^{t_f}
\end{aligned}
\tag{2.3.10}
$$

把式(2.3.3)的边界条件代入(2.3.10)，得到

$$ \delta J(x^*(t),\delta x(t))
= \int_{t_0}^{t_f} 
        \left[ 
            \left( \frac{\partial V}{\partial x} \right)_*
          - \frac{d}{dt} 
                \left( \frac{\partial V}{\partial \dot{x}} \right)_*
        \right]
        \delta x(t)dt 
\tag{2.3.11}
$$

**Step 4: Fundamental Theorem**

&emsp;&emsp;根据定理2.1（fundamental theorem of the calculus of variations），$$ x^*(t) $$要存在，则$$ \delta J(x^*(t),\delta x(t)) = 0 $$

$$ 
\int_{t_0}^{t_f} 
    \left[ 
        \left( \frac{\partial V}{\partial x} \right)_*
      - \frac{d}{dt} \left( \frac{\partial V}{\partial \dot{x}} \right)_*
        \right]
        \delta x(t)dt 
= 0
\tag{2.3.12}
$$

**Step 5: Fundamental Lemma**

&emsp;&emsp;为了简化方程(2.3.12)的条件，利用fundamental lemma of the calculus of variations

**LEMMA 2.1** 对于任意连续函数$$ g(t) $$

$$ \int_{t_0}^{t_f} {g(t) \delta x(t) dt} = 0
\tag{2.3.13}
$$

其中，函数$$ \delta x(t) $$在区间$$ [t_0,t_f] $$之间连续，那么函数$$ g(t) $$在区间$$ [t_0,t_f] $$之间必定处处为零。

**Step 6: Euler-Lagrange Equation**

&emsp;&emsp;根据引理2.1，$$ x^*(t) $$是式(2.3.1)中泛函$$ J $$的最优解的一个必要条件为

$$ 
  \left(
        \frac{\partial V(x^*(t),\dot{x}^*(t),t)}{\partial x}
  \right)_*  
- \frac{d}{dt} 
  \left(
        \frac{\partial V(x^*(t),\dot{x}^*(t),t)}{\partial \dot{x}}
  \right)_*  
= 0
\tag{2.3.14} 
$$

可以简化为

$$\color{green}{
\begin{aligned}
    \boxed{
        \left( \frac{\partial V}{\partial x} \right)_*  
      - \frac{d}{dt} 
        \left( \frac{\partial V}{\partial \dot{x}} \right)_*  
      = 0  }
\end{aligned}
}
\tag{2.3.15}
$$

对所有的$$ t \in [t_0,t_f] $$均成立，此方程称为<font color="#3FBF3F">Euler equation</font>。

### 3.2 Discussion on Euler-Lagrange Equation

1.EL方程的变形

$$ \begin{aligned}
    \boxed{
        V_x - V_{t \dot{x}} 
      - V_{x \dot{x}}\dot{x}^*(t) 
      - V_{\dot{x} \dot{x}}\ddot{x}^*(t) 
      = 0
    }
\end{aligned}
\tag{2.3.19}
$$

2.EL方程(2.3.14)是微分方程。

3.$$ \frac{\partial V(x^*(t),\dot{x}^*(t),t)}{\partial \dot{x}} $$是关于$$ x^*(t) $$、$$ \dot{x}^*(t) $$和$$ t $$的函数，所以该函数是可微的。从EL方程的变形的变形也可以看出，微分方程(2.3.14)一般是二阶的。

4.如果有涉及$$ \ddot{x}^*(t) $$、$$ \dot{x}^*(t) $$和$$ t $$的乘积或幂的项，那么这个微分方程会变成非线性的。

5.系数可能是时变的。

6.起点和终点处的条件会带来<font color="#3FBF3F">边值问题</font>。

7.<font color="#3399ff">Euler-Lagrange方程一般来说，是一个非线性、时变、两点边值、二阶常微分方程。</font>因此，我们得到了一个非线性两点边值问题（<font color="#3FBF3F">TPBVP</font>）。

```note
TPBVP问题的求解很麻烦，通常要用数值方法。
```

8.满足EL方程只是最优解的<font color="#3399ff">必要条件</font>。

### 3.3 Different Cases for Euler-Lagrange Equation

**Case 1**：$$ V $$与$$ \dot{x}(t) $$和$$ t $$相关，即$$ V = V(\dot{x}(t),t) $$。那么$$ V_x = 0 $$。EL方程变为

$$ \frac{d}{dt} (V_{\dot{x}}) = 0
\tag{2.3.20}
$$

所以，有

$$ V_{\dot{x}}
= \frac{\partial V(\dot{x}^*(t),t)}{\partial \dot{x}} 
= C
\tag{2.3.21}
$$

其中，$$ C $$为积分常数。

**Case 2**：$$ V $$仅与$$ \dot{x}(t) $$相关，即$$ V = V(\dot{x}(t)) $$。那么$$ V_x = 0 $$。EL方程变为

$$ \frac{d}{dt} (V_{\dot{x}}) = 0
\rightarrow
V_{\dot{x}} = C
\tag{2.3.22}
$$

一般来说，(2.3.21)或(2.3.22)的解

$$ \dot{x}^*(t) = C_1
\rightarrow
x^*(t) = C_1 t + C_2
\tag{2.3.23}
$$

是直线方程。

**Case 3**：$$ V $$与$$ x(t) $$和$$ \dot{x}(t) $$相关，即$$ V = V(x(t),\dot{x}(t)) $$。那么$$ V_{t \dot{x}} = 0 $$。(2.3.19)形式的EL方程变为

$$ V_x -V{x \dot{x}} - V_{\dot{x} \dot{x}} \ddot{x}^*(t) = 0
\tag{2.3.24}
$$

两边同时乘上$$ \dot{x}^*(t) $$，得

$$ \dot{x}^*(t)
[V_x -V{x \dot{x}} - V_{\dot{x} \dot{x}} \ddot{x}^*(t)]
= 0
\tag{2.3.25}
$$

可以化成

$$ \frac{d}{dt} (V - \dot{x}^*(t)V_{\dot{x}}) = 0
\rightarrow
V - \dot{x}^*(t)V_{\dot{x}} = C
\tag{2.3.26}
$$

上述方程解法很多，比如变量分离法。

**Case 4**：$$ V $$与$$ x(t) $$和$$ t $$相关，即$$ V = V(x(t),t) $$。那么$$ V_{\dot{x}} = 0 $$。EL方程变为

$$ \frac{\partial V(x^*(t),t)}{\partial x} = 0
\tag{2.3.27}
$$

该方程的解不包含任意常数，因此一般来说不满足边界条件$$ x(t_0) $$和$$ x(t_f) $$。因此，一般来说，这种变分问题无解。只有少数函数$$ x(t) $$满足边界条件的情况下，它才是最优解。

&emsp;&emsp;变分法的一个经典例子就是最速降线（brachistochrone）问题，几乎所有关于变分法的书籍都涉及这个问题。

```warning
本节中考虑的都是fixed-end问题，起点和终点都是固定的。
```

<br /> 

## 4 The Second Variation

&emsp;&emsp;为了确定最优解，需要考虑二阶变分

$$ \delta^2 J
= \int_{t_0}^{t_f} 
    \frac{1}{2!} 
    \left[
        \left( \frac{\partial^2 V}{\partial x^2} \right)_*
        (\delta x(t))^2
      + \left( \frac{\partial^2 V}{\partial \dot{x}^2} \right)_*
        (\delta \dot{x}(t))^2
      + 2 \left( \frac{\partial^2 V}{\partial x \partial \dot{x}} \right)_*
        \delta x(t) \delta \dot{x}(t)
    \right] dt
\tag{2.4.1}
$$

考虑上式的最后一项，采用分部积分法将其改写成只有$$ \delta x(t) $$的形式。然后利用条件$$ \delta x(t_0) = \delta x(t_f) = 0 $$，可得

$$ \delta^2 J
= \frac{1}{2}
  \int_{t_0}^{t_f} 
    \left[
        \left \{
            \left( \frac{\partial^2 V}{\partial x^2} \right)_*
          - \frac{d}{dt} 
            \left( \frac{\partial^2 V}{\partial x \partial \dot{x}} \right)_*
        \right \}
        (\delta x(t))^2
      + \left( \frac{\partial^2 V}{\partial \dot{x}^2} \right)_*
        (\delta \dot{x}(t))^2
    \right] dt
\tag{2.4.2}
$$

根据定理2.1，充分条件还需要满足：要求最小值，$$ \delta^2 J \lt 0 $$。也就是说，对于任意的$$ \delta x(t) $$和$$ \delta \dot{x}(t) $$，满足

$$
\left( \frac{\partial^2 V}{\partial x^2} \right)_*
- \frac{d}{dt} \left( \frac{\partial^2 V}{\partial x \partial \dot{x}} \right)_*
\gt 0 ,     
\tag{2.4.3}
$$

$$ \left( \frac{\partial^2 V}{\partial \dot{x}^2} \right)_* \gt 0  
\tag{2.4.4}
$$

对于最大值，以上条件的符号不变。取而代之的是，将二阶变分(2.4.1)改写成矩阵形式

$$ \begin{aligned}
   \delta^2 J 
& = \frac{1}{2} \int_{t_0}^{t_f}
    {   \begin{bmatrix}
            \delta x(t) & \delta \dot{x}(t) \\
        \end{bmatrix}
        \begin{bmatrix}
            \frac{\partial^2 V}{\partial x^2} & 
            \frac{\partial^2 V}{\partial x \partial \dot{x}} \\[2ex]
            \frac{\partial^2 V}{\partial x \partial \dot{x}} & 
            \frac{\partial^2 V}{\partial \dot{x}^2} \\
        \end{bmatrix}
        \begin{bmatrix}
            \delta x(t) \\ \delta \dot{x}(t) \\
        \end{bmatrix}
    }dt \\
& = \frac{1}{2} \int_{t_0}^{t_f}
    {   \begin{bmatrix}
        \delta x(t) & \delta \dot{x}(t)
        \end{bmatrix}
        \Pi
        \begin{bmatrix}
            \delta x(t) \\ \delta \dot{x}(t) \\
        \end{bmatrix}
    }dt 
\end{aligned}
\tag{2.4.5}
$$

如果，矩阵$$ \Pi $$是正（负）定的，就可以得到最小（大）值。大多数情况下，由于$$ \delta x(t) $$是任意的，所以$$ (\delta \dot{x}(t))^2 $$的系数，i.e.$$ \partial^2 V / \partial \dot{x}^2 $$决定了$$ \delta^2 J $$的正负。也就是说，<font color="#3399ff">二阶变分的符号与</font>$$\color{blue}{\partial^2 V / \partial \dot{x}^2} $$<font color="#3399ff">相同</font>。因此，最小化要求

$$ \color{green}{
\boxed{
    \left( \frac{\partial^2 V}{\partial \dot{x}^2} \right)_* \gt 0  }
} \tag{2.4.7}
$$

对于最大化，上式的符号不变。该条件称为<font color="#3FBF3F">Legendre condition</font>（或Legendre-Jacobi condition）。

<br /> 

## 5 Extrema of Functions with Conditions

&emsp;&emsp;求解函数条件极值的两种方法：1.Direct Method；2.Lagrange multiplier method。 

### 5.1 Direct Method

&emsp;&emsp;求函数$$ f(x_1,x_2) $$的极值，$$ x_1,x_2 $$是interdependent（相关）的变量，满足条件

$$ g(x_1,x_2) = 0
\tag{2.5.16}
$$

由极值的必要条件，有

$$ df 
= \frac{\partial f}{\partial x_1} dx_1
+ \frac{\partial f}{\partial x_2} dx_2
= 0
\tag{2.5.17}
$$

然而由于条件(2.5.16)，所以$$ dx_1 $$和$$ dx_2 $$不是任意的，它们之间需要满足关系

$$ dg
= \frac{\partial g}{\partial x_1} dx_1
+ \frac{\partial g}{\partial x_2} dx_2
= 0
\tag{2.5.18}
$$

&emsp;&emsp;为了同时满足条件(2.5.16)和极值条件(2.5.17)，假设$$ x_1 $$为自变量，$$ x_2 $$为因变量。假设$$ \partial g / \partial x_2 \neq 0 $$，那么(2.5.18)变为

$$ dx_2 
= - \left\{ \frac{\partial g / \partial x_1}{\partial g / \partial x_2} \right\} dx_1
\tag{2.5.20}
$$

代入(2.5.17)得

$$ df
= \left[ 
      \frac{\partial f}{\partial x_1} 
    - \frac{\partial f}{\partial x_2} 
      \left\{ 
          \frac{\partial g / \partial x_1}{\partial g / \partial x_2} 
      \right\}
  \right] dx_1
= 0
\tag{2.5.21}
$$

假设$$ dx_1 $$是任意的，为了满足(2.5.21)，$$ dx_1 $$应该为0，即

$$ 
  \left( \frac{\partial f}{\partial x_1} \right)
  \left( \frac{\partial g}{\partial x_2} \right)
- \left( \frac{\partial f}{\partial x_2} \right)
  \left( \frac{\partial g}{\partial x_1} \right)
= 0
\tag{2.5.22}
$$

上式和条件(2.5.16)可同时求出最优解$$ x_1^* $$和$$ x_2^* $$。方程(2.5.23)可以改写成行列式形式

$$ \left|
\begin{array}{cccc} 
    \frac{\partial f}{\partial x_1} & \frac{\partial f}{\partial x_2} \\[2ex]
    \frac{\partial g}{\partial x_1} & \frac{\partial g}{\partial x_2}
\end{array}
\right|
= 0
\tag{2.5.23}
$$

&emsp;&emsp;$$ f $$和$$ g $$的Jacobian（雅可比行列式）与$$ x_1 $$和$$ x_2 $$均相关，这种直接消去因变量的方法对于求解高阶问题很麻烦。


### 5.2 Lagrange Multiplier Method

&emsp;&emsp;利用<font color="#3FBF3F">augmented Lagrangian function</font>（增广拉格朗日函数）

$$ \mathcal{L}(x_1,x_2,\lambda)
= f(x_1,x_2) + \lambda g(x_1,x_2)
\tag{2.5.25}
$$

其中，$$ \lambda $$是<font color="#3FBF3F">Lagrange multipier</font>。把条件(2.5.16)代入Lagrangian，得

$$ \mathcal{L}(x_1,x_2) = f(x_1,x_2) 
\tag{2.5.26}
$$

因此，极值的一个必要条件为

$$ df = d \mathcal{L} = 0
\tag{2.5.27}
$$

或

$$  d \mathcal{L} 
= df + \lambda dg
= 0
\tag{2.5.28}
$$

把(2.5.17)和(2.5.18)代入(2.5.28)可得

$$\left[ \frac{\partial f}{\partial x_1}
        + \lambda \frac{\partial g}{\partial x_1}
  \right] dx_1
+ \left[ \frac{\partial f}{\partial x_2}
        + \lambda \frac{\partial g}{\partial x_2}
  \right] dx_2
= 0
\tag{2.5.29}
$$

此时的$$ dx_1 $$和$$ dx_2 $$都是不独立的，因此无法直接得出两者系数都必须为0的结论。现假设$$ dx_1 $$是独立微分，那么根据(2.5.18)有$$ dx_2 $$是不独立微分。然后选择我们引入的乘数$$ \lambda $$，让$$ \lambda $$取使得$$ dx_2 $$系数为0的值$$ \lambda ^* $$，即

$$\frac{\partial f}{\partial x_2}
+ \lambda^* \frac{\partial g}{\partial x_2}
= 0
\tag{2.5.30}
$$

这样，我们就可以把式(2.5.29)化简得到

$$\left[ \frac{\partial f}{\partial x_1}
        + \lambda \frac{\partial g}{\partial x_1}
  \right] dx_1
= 0
\tag{2.5.31}
$$

由于$$ dx_1 $$是独立的微分，它的取值是任意的，所以上式只有当系数为0的时候成立，即

$$\frac{\partial f}{\partial x_1}
+ \lambda^* \frac{\partial g}{\partial x_1}
= 0
\tag{2.5.32}
$$

根据augmented Lagrangian function(2.5.25)，由

$$\frac{\partial \mathcal{L}}{\partial \lambda} = 0
\tag{2.5.33}
$$

得出约束条件(2.5.16)。将(2.5.32)(2.5.30)和(2.5.33)的结果综合起来，可以得到

$$\frac{\partial \mathcal{L}}{\partial x_1}
= \frac{\partial f}{\partial x_1} + \lambda^* \frac{\partial g}{\partial x_1}
= 0
\tag{2.5.34}
$$

$$\frac{\partial \mathcal{L}}{\partial x_2}
= \frac{\partial f}{\partial x_2} + \lambda^* \frac{\partial g}{\partial x_2}
= 0
\tag{2.5.35}
$$

$$\frac{\partial \mathcal{L}}{\partial \lambda} 
= g(x_1^*,x_2^*)
= 0
\tag{2.5.36}
$$

以上三个式子可以同时求解出$$ x_1^*$$，$$x_2^* $$和$$ \lambda^* $$。消去(2.5.34)和(2.5.35)中的$$ \lambda^* $$，可得

$$\left( \frac{\partial f}{\partial x_1} \right)
  \left( \frac{\partial g}{\partial x_2} \right)
- \left( \frac{\partial f}{\partial x_2} \right)
  \left( \frac{\partial g}{\partial x_1} \right)
= 0
\tag{2.5.37}
$$

和直接法得到的(2.5.22)一样。

```note
乘数λ的引入让我们可以在增广函数中同时处理所有变量。所以，乘数的作用类似于催化剂，只在中间过程起作用。
```

&emsp;&emsp;<font color="#3399ff">总结</font>：函数$$ f(x_1,x_2) $$在条件$$ g(x_1,x_2)=0 $$下的极值等于增广函数$$ \mathcal{L}(x_1,x_2,\lambda) = f(x_1,x_2)+\lambda g(x_1,x_2) $$的极值，尽管$$  x_1 $$，$$ x_2 $$和$$ \lambda $$是互不相关的。

**THEOREM 2.2** 求连续的实值函数$$ f(\mathbf{x}) = f(x_1,x_2,\cdots,x_n) $$的极值，函数满足条件

$$
g_1(\mathbf{x}) = g_1(x_1,x_2,\cdots,x_n) = 0 \\
g_2(\mathbf{x}) = g_2(x_1,x_2,\cdots,x_n) = 0 \\
\vdots \\
g_m(\mathbf{x}) = g_m(x_1,x_2,\cdots,x_n) = 0
\tag{2.5.38}
$$

其中，$$ f $$和$$ g $$有连续偏导数，且$$ m \lt n $$。令$$ \lambda_1,\lambda_2,\cdots,\lambda_m $$为与$$ m $$个条件相对应的Lagrange multipliers，得到增广Lagrangian函数

$$\mathcal{L}(\mathbf{x,\lambda})
= f(\mathbf{x}) + \mathbf{\lambda ^T g (x)}
\tag{2.5.39}
$$

其中，$$ \mathbf{\lambda ^T} $$是$$ \mathbf{\lambda} $$的转置。那么。最优值$$ \mathbf{x}^* $$和$$ \mathbf{\lambda}^* $$是以下$$ n+m $$个方程的解

$$\frac{\partial \mathcal{L}}{\partial \mathbf{x}}
= \frac{\partial f}{\partial \mathbf{x}} 
  + \mathbf{\lambda ^T} \frac{\partial \mathbf{g}}{\partial \mathbf{x}}
= 0 
\tag{2.5.40}
$$

$$\frac{\partial \mathcal{L}}{\partial \mathbf{\lambda}} 
= \mathbf{g(x)} 
= 0
\tag{2.5.41}
$$

**Features of Lagrange Multiplier**：拉格朗日乘数法是求解函数条件极值的有效方法，有以下优势：

1. 将求解函数条件极值问题嵌入到<font color="#3399ff">求单个增广函数极值</font>的过程中。
2. 可以在增广函数$$ \mathcal{L}(\mathbf{x,\lambda}) $$中<font color="#3399ff">同时处理所有相互独立的变量</font>$$ \mathbf{x} $$和$$ \mathbf{\lambda} $$。
3. 乘数$$ \lambda $$在2的过程中起类似于催化剂的作用。
4. 拉格朗日乘数法的特点是增广维数$$ (n+m) $$，其相对简单和系统的计算过程通常可以补偿这点。

<br /> 

## 6 Extrema of Functionals with Conditions

&emsp;&emsp;以只有两个变量的泛函为例，推导出必要条件，然后推广到n阶向量的情况。考虑以泛函形式表示的性能指标的极值

$$J(x_1(t),x_2(t),t)
= J
= \int_{t_0}^{t_f}
    { V(x_1(t),x_2(t),\dot{x}_1(t),\dot{x}_2(t),t) } dt
\tag{2.6.1}
$$

满足条件（设备或系统方程）

$$
g(x_1(t),x_2(t),\dot{x}_1(t),\dot{x}_2(t)) = 0
\tag{2.6.2}
$$

以及fixed-end-point条件

$$
x_1(t_0) = x_{10} ; \quad x_2(t_0) = x_{20} \\
x_1(t_f) = x_{1f} ; \quad x_2(t_f) = x_{2f} 
\tag{2.6.3}
$$

解决这个问题有以下几个步骤：

* Step 1: Lagrangian
* Step 2: Variations and Increment
* Step 3: First Variation
* Step 4: Fundamental Theorem
* Step 5: Fundamental Lemma
* Step 6: Euler-Lagrange Equation

**Step 1: Lagrangian**

&emsp;&emsp;构造增广泛函

$$J_a
= \int_{t_0}^{t_f}
    { \mathcal{L}(x_1(t),x_2(t),\dot{x}_1(t),\dot{x}_2(t),\lambda (t),t) } dt
\tag{2.6.4}
$$

其中，$$ \lambda (t) $$是拉格朗日乘数，拉格朗日函数$$ \mathcal{L} $$的定义为

$$\begin{aligned}
  \mathcal{L}
= & \mathcal{L}(x_1(t),x_2(t),\dot{x}_1(t),\dot{x}_2(t),\lambda (t),t) \\
= & V(x_1(t),x_2(t),\dot{x}_1(t),\dot{x}_2(t),t)
  + \lambda(t) g(x_1(t),x_2(t),\dot{x}_1(t),\dot{x}_2(t))    
\end{aligned}

\tag{2.6.5}
$$

从性能指标(2.6.1)和增广性能指标(2.6.4)中可以看出，对于任意$$ \lambda (t) $$，如果条件(2.6.2)满足，则有$$ J_a = J $$。

**Step 2: Variations and Increment**

&emsp;&emsp;假设最优值，然后写出变分和增量

$$x_i(t) = x_i^*(t) + \delta x_i(t) , \quad
\dot{x}_i(t) = \dot{x}_i^*(t) + \delta \dot{x}_i(t) , \qquad
i = 1,2 \\
\Delta J_a = J_a(x_i^*(t) + \delta x_i(t),\dot{x}_i^*(t) + \delta \dot{x}_i(t),t)
             - J_a(x_i^*(t),\dot{x}_i^*(t),t) ,
\text{for } i = 1,2
\tag{2.6.6}
$$

**Step 3: First Variation**

对$$ J_a $$的一阶变分作Taylor展开，然后保留线性项，得到

$$\begin{aligned}
  \delta J_a  
= \int_{t_0}^{t_f} 
    \bigg[
        & \left( \frac{\partial \mathcal{L}}{\partial x_1} \right)_* \delta x_1(t)
      +   \left( \frac{\partial \mathcal{L}}{\partial x_2} \right)_* \delta x_2(t) \\
      + & \left( \frac{\partial \mathcal{L}}{\partial \dot{x}_1} \right)_* \delta \dot{x}_1(t)
      +   \left( \frac{\partial \mathcal{L}}{\partial \dot{x}_2} \right)_* \delta \dot{x}_2(t)
    \bigg] dt   
\end{aligned}
\tag{2.6.7}
$$

和之前CoV的部分一样，将含$$ \delta \dot{x}_1(t) $$和$$ \delta \dot{x}_2(t) $$的项改写为只含$$ \delta x_1(t) $$和$$ \delta x_2(t) $$的形式（利用分部积分法）

$$
  \int_{t_0}^{t_f}
  {
    \left(\frac{\partial \mathcal{L}}{\partial x_1} \right)_*
    \delta \dot{x}_1(t) 
  } dt
=   \left. \left[ \left(\frac{\partial \mathcal{L}}{\partial \dot{x}_1}\right)_*
         \delta x_1(t)
    \right] \right| _{t_0}^{t_f}
  - \int_{t_0}^{t_f}
    {   \frac{d}{dt} 
        \left(\frac{\partial \mathcal{L}}{\partial \dot{x}_1}\right)_*
        \delta x_1(t)
    } dt
\tag{2.6.8}
$$

然后，一阶变分可以化成

$$\begin{aligned}
  \delta J_a
= & \int_{t_0}^{t_f} 
    \bigg[
         \left( \frac{\partial \mathcal{L}}{\partial x_1} \right)_* \delta x_1(t)
      +   \left( \frac{\partial \mathcal{L}}{\partial x_2} \right)_* \delta x_2(t) 
    \bigg] dt  \\
  & + \left. \left[ \left(\frac{\partial \mathcal{L}}{\partial \dot{x}_1}\right)_*
          \delta x_1(t)
      \right] \right| _{t_0}^{t_f}
    + \left. \left[ \left(\frac{\partial \mathcal{L}}{\partial \dot{x}_2}\right)_*
          \delta x_2(t)
      \right] \right| _{t_0}^{t_f} \\
  & - \int_{t_0}^{t_f}
    {   \frac{d}{dt} 
        \left(\frac{\partial \mathcal{L}}{\partial \dot{x}_1}\right)_*
        \delta x_1(t)
    } dt
    - \int_{t_0}^{t_f}
    {   \frac{d}{dt} 
        \left(\frac{\partial \mathcal{L}}{\partial \dot{x}_2}\right)_*
        \delta x_2(t)
    } dt
\end{aligned}
\tag{2.6.9}
$$

由于要满足(2.6.3)的给定边界时间和状态，所以边界处应该是没有变分的。也就是说

$$
  \delta x_1 (t_0)
= \delta x_2 (t_0)
= \delta x_1 (t_f)
= \delta x_1 (t_f)
= 0
\tag{2.6.10}
$$

把边界变分代入增广的一阶变分(2.6.9)中，得

$$\begin{aligned}
  \delta J_a
= & \int_{t_0}^{t_f} 
    \bigg[
        \left( \frac{\partial \mathcal{L}}{\partial x_1} \right)_* 
      - \frac{d}{dt} 
        \left(\frac{\partial \mathcal{L}}{\partial \dot{x}_1}\right)_*
    \bigg] \delta x_1(t) dt \\   
& + \int_{t_0}^{t_f} 
    \bigg[
        \left( \frac{\partial \mathcal{L}}{\partial x_2} \right)_* 
      - \frac{d}{dt} 
        \left(\frac{\partial \mathcal{L}}{\partial \dot{x}_2}\right)_*
    \bigg] \delta x_2(t) dt \\      
\end{aligned}
\tag{2.6.11}
$$

**Step 4: Fundamental Theorem**

&emsp;&emsp;1.利用变分法的基本原理（Theorem 2.1），让一阶变分为0。

&emsp;&emsp;2.$$ x_1(t) $$和$$ x_2(t) $$根据条件(2.6.2)相关的，所以$$ \delta x_1(t) $$和$$ \delta x_2(t) $$都是不独立的。因此，我们选定$$ \delta x_2(t) $$为自变分，$$ \delta x_1(t) $$为因变分。

&emsp;&emsp;3.决定乘数$$ \lambda ^* (t) $$的值，令一阶变分的系数为0，即
   
$$\left( \frac{\partial \mathcal{L}}{\partial x_1} \right)_*
- \frac{d}{dt}
  \left( \frac{\partial \mathcal{L}}{\partial \dot{x}_1} \right)_*
= 0
\tag{2.6.12}
$$  

这样，一阶变分(2.6.11)变为

$$
\int_{t_0}^{t_f}
{   \bigg[
        \left( \frac{\partial \mathcal{L}}{\partial x_2} \right)_*
      - \frac{d}{dt}
        \left( \frac{\partial \mathcal{L}}{\partial \dot{x}_2} \right)_*
    \bigg] \delta x_2(t)  
} dt
= 0
\tag{2.6.13}
$$

**Step 5: Fundamental Lemma**

&emsp;&emsp;利用CoV的基本引理（Lemma 2.1），由于$$ \delta x_2(t) $$被选为独立变分，所以取值是任意的，要令(2.6.13)成立，就必须要让$$ \delta x_1(t) $$的系数也消失，即

$$
  \left( \frac{\partial \mathcal{L}}{\partial x_2} \right)_*
       - \frac{d}{dt}
         \left( \frac{\partial \mathcal{L}}{\partial \dot{x}_2} 
  \right)_*
= 0
\tag{2.6.14}
$$

与此同时，从Lagrangian (2.6.5)要注意到

$$
\left( \frac{\partial \mathcal{L}}{\partial \lambda} \right)_* = 0 
\tag{2.6.15}
$$

可以得到约束条件(2.6.2)。

**Step 6: Euler-Lagrange Equation**

&emsp;&emsp;结合条件(2.6.12)(2.6.14)和(2.6.15)，泛函(2.6.1)在条件(2.6.2)下的极值需满足必要条件

$$
  \left( \frac{\partial \mathcal{L}}{\partial x_1} \right)_*
       - \frac{d}{dt}
         \left( \frac{\partial \mathcal{L}}{\partial \dot{x}_1} 
  \right)_*
= 0
\tag{2.6.16}
$$

$$
  \left( \frac{\partial \mathcal{L}}{\partial x_2} \right)_*
       - \frac{d}{dt}
         \left( \frac{\partial \mathcal{L}}{\partial \dot{x}_2} 
  \right)_*
= 0
\tag{2.6.17}
$$

$$\left( \frac{\partial \mathcal{L}}{\partial \lambda} \right)_* 
- \frac{d}{dt} 
  \left( \frac{\partial \mathcal{L}}{\partial \dot{\lambda}} \right)_* 
= 0 
\tag{2.6.18}
$$

```note
如果这两个变分是独立的，那么这几个条件本质上就是从Lagrangian (2.6.5)得到。并且在(2.6.18)中，Lagrangian是和乘数的导数无关的，因此条件(2.6.18)其实就是之前给出的方程(2.6.2)。  
因此Lagrange multiplier的引入使得我们可以处理两个独立变量（尽管它们因为条件约束而联系在一起）。
```

&emsp;&emsp;对于n阶系统，考虑如下泛函的极值

$$ J
= \int_{t_0}{t_f}
    { V(\mathbf{x}(t),\mathbf{\dot{x}}(t),t)} dt
\tag{2.6.19}
$$

其中，$$ \mathbf{x} $$为n阶状态向量，满足系统方程（条件）

$$
g_i(\mathbf{x}(t),\mathbf{\dot{x}}(t),t) = 0
\qquad i=0,1,\ldots,m
\tag{2.6.20}
$$

以及边界条件$$ \mathbf{x}(0) $$和$$ \mathbf{x}(t_f) $$。构造增广泛函

$$ J_a
= \int_{t_0}^{t_f}
  {
    \mathcal{L} (\mathbf{x}(t),\mathbf{\dot{x}}(t),\mathbf{\lambda}(t),t)
  } dt
\tag{2.6.21}
$$

其中，Lagrangian $$ \mathcal{L} $$为

$$\color{green}{
    \boxed{
		\mathcal{L} (\mathbf{x}(t),\mathbf{\dot{x}}(t),\mathbf{\lambda}(t),t)
	  = V(\mathbf{x}(t),\mathbf{\dot{x}}(t),t)
	    + \mathbf{\lambda}^T(t) g_i(\mathbf{x}(t),\mathbf{\dot{x}}(t),t)
}   }
\tag{2.6.22}
$$

其中，Lagrange multiplier $$ \lambda(t) = [\lambda_1(t),\lambda_2(t),\ldots,\lambda_m(t)]^T $$。对$$ J_a $$用Euler-Lagrange方程得到

$$\color{green}{
	\boxed{
		\left( \frac{\partial \mathcal{L}}{\partial \mathbf{x}} \right)_*
	  - \frac{d}{dt}
	    \left( \frac{\partial \mathcal{L}}{\partial \mathbf{\dot{x}}} \right)_*
	  = 0
}	}
\tag{2.6.23}
$$

$$\color{green}{
	\boxed{
		\left( \frac{\partial \mathcal{L}}{\partial \mathbf{\lambda}} \right)_*
	  - \frac{d}{dt}
	    \left( \frac{\partial \mathcal{L}}{\partial \mathbf{\dot{\lambda}}} \right)_*
	  = 0
	
		\rightarrow
		g_i(\mathbf{x}(t),\mathbf{\dot{x}}(t),t) = 0
}	}
\tag{2.6.24}
$$

由(2.6.22)可知，Lagrange multiplier $$ \lambda $$与$$ \mathbf{\dot{\lambda}}(t) $$无关，因此<font color="#3399ff">Euler-Lagrange方程只是给出了设备或系统的条件</font>。所以，我们可以根据给定的边界条件来求解EL方程。

<br />

## 7 Variational Approach to Optimal Control Systems

&emsp;&emsp;利用变分法接近最优控制系统，引入Hamiltonian函数，Pontryagin和他的同事利用这个函数来发展了著名的Minimum Principle。

### 7.1 Terminal Cost Problem

&emsp;&emsp;<font color="#3FBF3F">**Bolza问题**：性能指标的一般形式除了包含整体成本函数外，还包含最终(终端)成本函数。</font>Bolza问题的性能指标形式最具一般性。

&emsp;&emsp;考虑被控对象

$$\mathbf{\dot{x}}(t)
= \mathbf{f} ( \mathbf{x}(t),\mathbf{u}(t),t )
\tag{2.7.1}
$$

性能指标为

$$  J(\mathbf{u}(t))
=   S(\mathbf{x}(t_f),t_f)
  + \int_{t_0}^{t_f} {V(\mathbf{x}(t),\mathbf{u}(t),t)}dt
\tag{2.7.2}
$$

给定边界条件为

$$\mathbf{x}(t_0) = \mathbf{x}_0;
\qquad
\mathbf{x}(t_f) \text{is free and }
t_f \text{is free}
\tag{2.7.3}
$$

其中，$$ \mathbf{x}(t) $$和$$ \mathbf{u}(t) $$分别为n维状态向量和r维控制向量。已知

$$\int_{t_0}^{t_f}
    { \frac{d S(\mathbf{x}(t),t)}{dt} } dt
= S(\mathbf{x}(t),t)|_{t_0}^{t_f}
= S(\mathbf{x}(t_f),t_f) - S(\mathbf{x}(t_0),t_0)
\tag{2.7.4}
$$

把式(2.7.4)代入初始的性能指标(2.7.2)中，得到

$$\begin{aligned}
    J_2(\mathbf{u}(t))
& =   \int_{t_0}^{t_f}
      { \left[ V(\mathbf{x}(t),\mathbf{u}(t),t) + \frac{dS}{dt} \right] } dt \\
& =   \int_{t_0}^{t_f} {V(\mathbf{x}(t),\mathbf{u}(t),t)} dt
    + S(\mathbf{x}(t_f),t_f) - S(\mathbf{x}(t_0),t_0)  
\end{aligned}
\tag{2.7.5}
$$

由于$$ S(\mathbf{x}(t_0),t_0) $$的值是固定的，所以优化$$ J $$和$$ J_2 $$本质上是一样的，因为<font color="#3399ff">这里只关注找到最优控制</font>，而不关注最优成本。还有一点需要指出的是

$$\frac{d[S(\mathbf{x}(t),t)]}{dt}
= \left( \frac{\partial S}{\partial \mathbf{x}} \right)'
  \mathbf{\dot{x}}(t)
  + \frac{\partial S}{\partial t}
\tag{2.7.6}
$$

* Step 1: Assumption of Optimal Conditions
* Step 2: Variations of Control and State Vectors
* Step 3: Lagrange Multiplier
* Step 4: Lagrangian
* Step 5: First Variation
* Step 6: Condition for Extrema
* Step 7: Hamiltonian

**Step 1: Assumption of Optimal Conditions**

&emsp;&emsp;假设$$ \mathbf{x}^*(t) $$和$$ \mathbf{u}^*(t) $$分别为状态和控制的最优值，那么

$$
  J(\mathbf{u}^*(t))
= \int_{t_0}^{t_f}
    { \left[ V(\mathbf{x}^*(t),\mathbf{u}^*(t),t) 
            + \frac{dS(\mathbf{x}^*(t),t)}{dt} \right] } dt \\[2ex]
  \mathbf{\dot{x}}^*(t) 
= \mathbf{f}(\mathbf{x}^*(t),\mathbf{u}^*(t),t)  
\tag{2.7.7}
$$

**Step 2: Variations of Control and State Vectors**

<center>
    <figure>
        <img src="../../notebook\part3\images\fig2_7.JPG" width=400px>
        <figcaption>Figure 2.7 Free-Final Time and Free-Final State System</figcaption>
    </figure>
</center>

&emsp;&emsp;考虑如图2.7所示的状态和控制向量的变分（扰动）

$$
\mathbf{x}(t) = \mathbf{x}^*(t) + \delta \mathbf{x}(t) ,\quad
\mathbf{u}(t) = \mathbf{u}^*(t) + \delta \mathbf{u}(t)
\tag{2.7.8}
$$

那么，状态方程(2.7.1)和性能指标(2.7.5)变为

$$
  \mathbf{\dot{x}}^*(t) + \delta \mathbf{\dot{x}}(t)
= \mathbf{f}(\mathbf{x}^*(t)+\delta \mathbf{x}(t),
             \mathbf{u}^*(t)+\delta \mathbf{u}(t),
             t ) \\
  J(\mathbf{u}^*(t))
= \int_{t_0}^{t_f + \delta t_f}
    { \left[ V(\mathbf{x}^*(t)+\delta \mathbf{x}(t),
             \mathbf{u}^*(t)+\delta \mathbf{u}(t),
             t ) 
            + \frac{dS}{dt} 
      \right] 
    } dt
\tag{2.7.9}
$$





&emsp;&emsp;
<br />
$$
$$
$$  $$
<!-- 蓝 -->
<font color="#3399ff"></font>
<!-- 绿 -->
<font color="#3FBF3F"></font>